# componentsディレクトリ
## 1. `ModelViewer` コンポーネント

### 役割
- **FBX モデルの読み込みと表示:**  
  引数として受け取る `product` プロパティを基に，API 経由で FBX ファイルを取得し，Three.js のシーンに追加して表示させる
- **ロード状態の管理:**  
  モデルが読み込まれるまでローディングメッセージ（「モデルを読み込み中…」）を表示する．

### 主な処理
- `handleCreated` コールバック  
  `ThreeCanvas` の初期化が完了した時点で呼ばれる．  
  この中で，`/api/fbx` エンドポイントへリクエストを行い，取得した FBX ファイルの Blob を `FBXLoader` で読み込み，シーンに追加している．
- **シーンへの FBX の追加:**  
  読み込んだ FBX モデルに対してスケール調整を行い，Three.js のシーンに追加する．

### 使用しているコンポーネント
- **`ThreeCanvas`:**  
  3D シーン（カメラ，レンダラー，ライトなど）を構築するために利用．  
  `ModelViewer` において `ThreeCanvas` は，FBX モデルを読み込むためのベースとなるシーンの作成と制御を担当．

---

## 2. `ThreeCanvas` コンポーネント

### 役割
- **基本の 3D シーン構築:**  
  Three.js を使用してシーン，カメラ，レンダラー，ライトの設定を行い，ブラウザ上に描画する．
- **Webカメラ背景のオプション:**  
  `useWebcamBackground` プロパティが `true` の場合，Webカメラ映像をテクスチャとしてシーンの背景に設定する．
- **レスポンシブな描画:**  
  コンテナのリサイズに対応し，カメラとレンダラーのサイズを更新する．

### 主な処理
- **初期化:**  
  コンポーネントがマウントされたとき，内部で Three.js のシーンを作成．  
  カメラ，レンダラー（antialias と preserveDrawingBuffer を考慮）を生成し，コンテナ要素にキャンバスを追加する．
- **ライトの追加:**  
  アンビエントライトとディレクショナルライトがシーンに追加され，モデルや背景の可視性を向上させる．
- **Webカメラ映像の設定:**  
  `navigator.mediaDevices.getUserMedia` を用いて Webカメラの映像を取得し，Three.js の `VideoTexture` としてシーンの背景に設定する．
- **コールバック:**  
  `onCreated` プロパティを通じ，シーン，カメラ，レンダラー，コンテナの生成完了時に上位コンポーネントへ提供する．
- **アニメーションループ:**  
  `requestAnimationFrame` によるループ内で毎フレームシーンがレンダリングされ，リアルタイムな描画を実現する．

---

## 3. `ThreeWebcam` コンポーネント

### 役割
- **Webカメラ背景とオーバーレイ:**  
  `ThreeCanvas` コンポーネントを利用し，Webカメラの映像を背景として設定．  
  加えて，指定された画像（例: ロゴ）をオーバーレイとして重ねて表示する．
- **定期的なキャプチャ:**  
  `onDetect` コールバックを利用して，Canvas 要素から定期的に画像（Base64 エンコード済み）をキャプチャし，上位コンポーネントに渡します（例: 画像認識や解析用）．

### 主な処理
- **`handleCreated` コールバック:**  
  `ThreeCanvas` の `onCreated` プロパティとして利用するコールバックで，ここで一定間隔（2000ミリ秒ごと）にレンダラーのキャンバスからデータをキャプチャし，`onDetect` コールバックを呼び出す．
- **オーバーレイ画像の配置:**  
  `overlaySrc` プロパティが指定されている場合，絶対配置された `<img>` タグで，薄い（半透明）画像としてオーバーレイを表示する．

---

## 各コンポーネントの関係性

1. **`ThreeCanvas` を基盤とする:**
    - **共通機能:**  
      `ThreeCanvas` コンポーネントはシーン構築，カメラ，レンダラーの初期化，背景設定，アニメーションループなど，3D 描画に必要な共通の処理全体を担当する．
    - **再利用性:**  
      これにより，`ModelViewer` や `ThreeWebcam` コンポーネントは，共通の 3D シーン生成ロジックを再利用しつつ，それぞれの固有の機能（FBX モデル読み込みや画像キャプチャ，オーバーレイ表示）を実装できる．

2. **`ModelViewer` の役割:**
    - **FBX モデル読み込み:**  
      `ModelViewer` は Three.js のシーン上に 3D モデルを描画するために利用され，`ThreeCanvas` をベースにして FBX ファイルの取得と読み込みを行う．
    - **ユーザー体験向上:**  
      モデルのロード状態を管理し，ロード中はメッセージを表示することで，ユーザーに現在の状態を明示する．

3. **`ThreeWebcam` の役割:**
    - **Webカメラ利用とデータキャプチャ:**  
      `ThreeWebcam` は Three.js のシーンを Webカメラ映像で背景設定し，定期的に Canvas 画像をキャプチャする仕組みを提供する．
    - **オーバーレイ:**  
      指定された画像（例えばロゴ）をシーン上にオーバーレイすることで，AR 的な演出やブランディングを実現する．
    - **データ検出:**  
      キャプチャされたデータを `onDetect` コールバックで上位のロジック（例: ロゴ検出や解析 API 呼び出し）に渡す役割も持っている．

---

## まとめ

- **`ThreeCanvas`:**  
  シーンのセットアップ，描画と共通機能の提供を行う基盤コンポーネント．

- **`ModelViewer`:**  
  `ThreeCanvas` を利用して FBX モデルの取得および描画を行い，商品の 3D モデル表示に特化している．

- **`ThreeWebcam`:**  
  `ThreeCanvas` を基に，Webカメラ映像を背景とした描画，定期的な画像キャプチャ，さらにオーバーレイ画像表示など，さらに詳細な映像処理を実現する．

これらのコンポーネントは，共通の Three.js シーン生成ロジックを持つ `ThreeCanvas` を中心に連携し，ユーザー体験の向上や高度な描画処理を実現するために設計されている．