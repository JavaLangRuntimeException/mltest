# 顔認識によるアイスのリコメンド機能

## 機能の意義・目的
ユーザーが自販機の前で迷うことなく、自分の気分に合ったアイスを選べるようにすることで、
購買体験の「手間」や「選択の不安」を減らし、楽しさと満足度を高める。
また、SNSなどでのシェアを促進し、ユーザー同士のコミュニケーションを活性化させる。

この機能は、ユーザーの表情をリアルタイムで分析し、最適なアイスを提案することで、
購買意欲を高めることを目的としている。

## 機能概要
ユーザーの表情をカメラで取得し、リアルタイムで感情分析を行う。
分析結果に基づいて、複数のアイスの中から最も適した商品を選び、3Dモデルとして視覚的に提示する。

## サブ機能一覧

[//]: # (1. カメラの起動)
1. カメラ画像の送信
2. 表情分析（Python API）
3. リコメンドアイスの決定
4. ログの保存（DB）
5. アイスの3Dモデル取得（S3） 
6. 3Dモデルの表示

## サブ機能詳細

---

[//]: # (### 1. カメラの起動)

[//]: # ()
[//]: # (| 項目 | 内容                                                 |)

[//]: # (|------|----------------------------------------------------|)

[//]: # (| **目的** | 顔画像をリアルタイムで取得する                                    |)

[//]: # (| **入力** | ユーザー画像をアップロード                                      |)

[//]: # (| **処理内容** | `navigator.mediaDevices.getUserMedia&#40;&#41;` で映像ストリーム取得 |)

[//]: # (| **出力** | `<video>` タグにユーザーの映像を表示                            |)

[//]: # (| **例外** | カメラ拒否時はモーダルで再許可を促す                                 |)

[//]: # ()
[//]: # (---)

### 1. カメラ画像の送信

| 項目 | 内容                                           |
|------|----------------------------------------------|
| **目的** | 取得した画像をバックエンドへ送信する                           |
| **入力** | formDataに格納された画像データ                           |
| **処理** | `fetch("/api/analyze", POST)` でGoサーバーに送信 |
| **出力** | レスポンス無し（処理完了時にステータス返却）                       |

---

### 2. 表情分析（Python API）
| 項目     | 内容                                             |
|--------|------------------------------------------------|
| **目的** | 画像から顔を検出し、感情を分析する                              |
| **入力** | Goサーバーから送信された画像                                |
| **処理** | `deepface` ライブラリを使用して顔検出                       |
| **出力** | 検出された顔の位置と感情分析結果（happy, sad, angry, neutralなど） |
| **例外** | 顔が検出できない場合はエラーメッセージを返却                         |

---

### 3. リコメンドアイスの決定
| 項目     | 内容                                   |
|--------|--------------------------------------|
| **目的** | 表情分析結果に基づいてアイスをリコメンドする               |
| **入力** | 表情分析結果（happy, sad, angry, neutralなど） |
| **処理** | 表情に応じたアイスのリストを取得                     |
| **出力** | リコメンドアイスのID                          |
| **例外** | リコメンドアイスが見つからない場合はエラーメッセージを返却        |

---

### 4. ログの保存（DB）
| 項目     | 内容                    |
|--------|-----------------------|
| **目的** | リコメンドアイスの情報をDBに保存する   |
| **入力** | リコメンドアイスのID、cookie情報のセッションID |
| **処理** | DBにリコメンドアイスの情報を保存 |
| **出力** | 保存成功/失敗のステータス |
| **例外** | DB接続エラー時はエラーメッセージを返却 |

---

### 5. アイスの3Dモデル取得（S3）
| 項目     | 内容                    |
|--------|-----------------------|
| **目的** | リコメンドアイスの3Dモデルを取得する |
| **入力** | リコメンドアイスのID |
| **処理** | S3から3DモデルのURLを取得 |
| **出力** | 3DモデルのURL |
| **例外** | S3接続エラー時はエラーメッセージを返却 |

---

### 6. 3Dモデルの表示
| 項目     | 内容                    |
|--------|-----------------------|
| **目的** | リコメンドアイスの3Dモデルを表示する |
| **入力** | 3DモデルのURL |
| **処理** | Three.jsを使用して3Dモデルを表示 |
| **出力** | 3Dモデルの表示 |
| **例外** | 3Dモデル読み込みエラー時はエラーメッセージを返却 |

---


## 関連シーケンス図
[sequence_diagrams.md#face_recommendation](../architecture/sequence_diagrams.md#face_recommendation)

